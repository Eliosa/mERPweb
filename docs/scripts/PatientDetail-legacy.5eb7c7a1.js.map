{"version":3,"file":"PatientDetail-legacy.5eb7c7a1.js","sources":["../../src/views/patient/patientDetail/PatientDetail.vue"],"sourcesContent":["<script lang=\"ts\">\nexport default {\n  name: 'PatientDetail',\n}\n</script>\n\n<script setup lang=\"ts\">\nimport { usePatientInfoStore } from '@/stores/patientInfoStore'\nimport { storeToRefs } from 'pinia'\nimport { defineAsyncComponent, onMounted, onActivated } from 'vue'\nimport type { Component } from 'vue'\nimport { useRoute } from 'vue-router'\n\nconst route = useRoute()\nconst patientInfoStore = usePatientInfoStore()\nconst { detailTabs, activeTab } = storeToRefs(patientInfoStore)\n\ninterface NavItem {\n  id: string\n  title: string\n  component?: Component\n  children?: NavItem[]\n}\n\n// 默认打开的标签页ID\nconst defaultOpenTabId = 'patient-basic'\n// 导航菜单配置\nconst navItems: NavItem[] = [\n  {\n    id: 'basic',\n    title: '基本信息',\n    children: [\n      {\n        id: 'patient-basic',\n        title: '患者基本信息',\n        component: defineAsyncComponent(() => import('./components/PatientBasicInfo.vue')),\n      },\n      {\n        id: 'patient-surgery',\n        title: '手术信息',\n        component: defineAsyncComponent(() => import('./components/PatientSurgeryInfo.vue')),\n      },\n    ],\n  },\n  {\n    id: 'nursing',\n    title: '护理信息',\n    component: defineAsyncComponent(() => import('./components/PatientNursingInfo.vue')),\n  },\n  {\n    id: 'records',\n    title: '病历记录',\n    component: defineAsyncComponent(() => import('./components/PatientMedicalRecords.vue')),\n  },\n]\n\n// 根据ID获取导航项\nconst getNavItemById = (id: string) => {\n  const findItem = (items: NavItem[], targetId: string): NavItem | undefined => {\n    for (const item of items) {\n      if (item.id === targetId) return item\n      if (item.children) {\n        const found = findItem(item.children, targetId)\n        if (found) return found\n      }\n    }\n    return undefined\n  }\n  return findItem(navItems, id)\n}\n\n// 处理导航点击\nconst handleNavClick = (item: NavItem) => {\n  if (item.id) {\n    patientInfoStore.addDetailTab(activeTab.value.patientId, item.title, {\n      id: item.id,\n      title: item.title,\n    })\n  }\n}\n\n// 处理标签页关闭\nconst handleTabClose = (tabId: string) => {\n  patientInfoStore.closeDetailTab(activeTab.value.patientId, tabId)\n}\n\n// 初始化或更新患者标签页\nconst initPatientTabs = () => {\n  const patientId = route.params.id as string\n  const patientName = route.params.name as string\n\n  console.log('初始化/更新患者标签页:', { patientId, patientName })\n\n  // 如果该患者没有标签页，添加默认标签页\n  if (!detailTabs.value[patientId]?.length) {\n    const tabInfo = getNavItemById(defaultOpenTabId)\n    patientInfoStore.addDetailTab(patientId, patientName, {\n      id: tabInfo?.id || '',\n      title: tabInfo?.title || '',\n    })\n  } else {\n    patientInfoStore.setActiveTab(patientId, patientName, detailTabs.value[patientId][0].id)\n  }\n}\n\n// 监听路由参数变化\n// watch(\n//   () => route.params,\n//   () => {\n//     initPatientTabs()\n//   },\n// )\n\nonMounted(() => {\n  initPatientTabs()\n})\n\nonActivated(() => {\n  console.log('组件激活，更新患者信息')\n  initPatientTabs()\n})\n</script>\n\n<template>\n  <div class=\"patient-detail\">\n    <!-- 左侧导航 -->\n    <div class=\"nav-sidebar\">\n      <!-- :default-openeds=\"[defaultOpenTabId]\" -->\n      <el-menu class=\"nav-menu\">\n        <template v-for=\"item in navItems\" :key=\"item.id\">\n          <!-- 带子菜单的导航项 -->\n          <template v-if=\"item.children?.length\">\n            <el-sub-menu :index=\"item.id\">\n              <template #title>\n                <span>{{ item.title }}</span>\n              </template>\n              <el-menu-item\n                v-for=\"child in item.children\"\n                :key=\"child.id\"\n                :index=\"child.id\"\n                @click=\"handleNavClick(child)\"\n              >\n                {{ child.title }}\n              </el-menu-item>\n            </el-sub-menu>\n          </template>\n          <!-- 普通导航项 -->\n          <template v-else>\n            <el-menu-item :index=\"item.id\" @click=\"handleNavClick(item)\">\n              {{ item.title }}\n            </el-menu-item>\n          </template>\n        </template>\n      </el-menu>\n    </div>\n\n    <!-- 右侧内容区 -->\n    <div class=\"content-area\">\n      <!-- 标签页导航 -->\n      <div class=\"tabs-container\" v-if=\"detailTabs[activeTab.patientId]?.length > 0\">\n        <el-tabs\n          v-model=\"activeTab.tabId\"\n          type=\"card\"\n          closable\n          @tab-remove=\"handleTabClose\"\n          class=\"detail-tabs\"\n        >\n          <el-tab-pane\n            v-for=\"tab in detailTabs[activeTab.patientId]\"\n            :key=\"tab.id\"\n            :label=\"tab.title\"\n            :name=\"tab.id\"\n          >\n            <component\n              :is=\"getNavItemById(tab.id)?.component\"\n              :patient-id=\"activeTab.patientId\"\n              :tab-type=\"tab.id\"\n            />\n          </el-tab-pane>\n        </el-tabs>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"less\">\n.patient-detail {\n  display: flex;\n  height: 100%;\n  background-color: #f5f7fa;\n\n  .nav-sidebar {\n    width: 200px;\n    background-color: #fff;\n    border-right: 1px solid #e4e7ed;\n\n    .nav-menu {\n      height: 100%;\n      border: none;\n    }\n  }\n\n  .content-area {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n\n    .tabs-container {\n      background: #fff;\n      border-bottom: 1px solid #e4e7ed;\n      padding: 0 16px;\n      height: 40px;\n      flex-shrink: 0;\n\n      .detail-tabs {\n        :deep(.el-tabs__header) {\n          margin: 0;\n          border: none;\n        }\n\n        :deep(.el-tabs__nav-wrap) {\n          &::after {\n            display: none;\n          }\n        }\n\n        :deep(.el-tabs__item) {\n          border: 1px solid #d9d9d9;\n          margin-right: 4px;\n          border-radius: 4px 4px 0 0;\n          padding: 0 16px;\n\n          &.is-active {\n            background: #409eff;\n            color: #ffffff;\n            border-color: #409eff;\n          }\n        }\n      }\n    }\n\n    .page-content {\n      flex: 1;\n      overflow: auto;\n      padding: 16px;\n    }\n  }\n}\n</style>\n"],"names":["name","route","useRoute","patientInfoStore","usePatientInfoStore","detailTabs","activeTab","storeToRefs","navItems","id","title","children","component","defineAsyncComponent","__vitePreload","module","import","getNavItemById","findItem","items","targetId","item","found","handleNavClick","addDetailTab","value","patientId","handleTabClose","tabId","closeDetailTab","initPatientTabs","_detailTabs$value$pat","params","patientName","console","log","length","setActiveTab","tabInfo","onMounted","onActivated","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_menu","class","_Fragment","_renderList","_item$children","key","_createBlock","_component_el_sub_menu","index","_toDisplayString","child","_component_el_menu_item","onClick","$event","_createTextVNode","_hoisted_3","_unref","_unref$unref$patientI","_hoisted_4","_component_el_tabs","modelValue","_cache","type","closable","onTabRemove","tab","_component_el_tab_pane","label","_getNavItemById","_resolveDynamicComponent"],"mappings":"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"}